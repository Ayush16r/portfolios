<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login Page</title>
  <link rel="stylesheet" href="login.css" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>
<body>
  <div id="login">
    <div class="container">
      <div class="heading">Sign In</div>

      <!-- Email + Password Login -->
      <form onsubmit="loginWithEmail(event)" class="form">
        <input required class="input" type="email" id="email" placeholder="E-mail" />
        <input required class="input" type="password" id="password" placeholder="Password" />
        <span class="forgot-password"><a href="#">Forgot Password ?</a></span>
        <input class="login-button" type="submit" value="Sign In" />
      </form>

      <!-- Google Login -->
      <div class="social-account-container">
        <span class="title">Or Sign in with</span>
        <div class="social-accounts">
          <button class="social-button google" onclick="signInWithGoogle()">Google</button>
        </div>
      </div>

      <!-- Phone Number + OTP Login -->
      <div style="margin-top:20px;">
        <span class="title">Or Sign in with Phone</span><br><br>
        <input type="tel" id="phoneNumber" placeholder="+919876543210" />
        <!-- Invisible reCAPTCHA container (hidden) -->
        <div id="recaptcha-container" style="display:none;"></div>
        <button onclick="sendOTP()">Send OTP</button>

        <div id="otpSection" style="display:none; margin-top:10px;">
          <input type="text" id="otpCode" placeholder="Enter OTP" />
          <button onclick="verifyOTP()">Verify OTP</button>
        </div>
      </div>

      <span class="agreement"><a href="#">Learn user licence agreement</a></span>
    </div>
  </div>

  <!-- Firebase Script -->
  <script>
    // ðŸ”¥ Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAzqZ_rEV_tnaGTuToh9sV_rPLcwWKSCA4",
      authDomain: "iter-buddys.firebaseapp.com",
      projectId: "iter-buddys",
      storageBucket: "iter-buddys.firebasestorage.app",
      messagingSenderId: "454713970037",
      appId: "1:454713970037:web:e1061c64f7aec924b5973c",
      measurementId: "G-JB27ZV06DQ"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // âœ… Email + Password Login
    function loginWithEmail(e) {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      auth.signInWithEmailAndPassword(email, password)
        .then((result) => {
          alert("Logged in as: " + result.user.email);
          window.location.href = "index.html";
        })
        .catch((error) => {
          alert("Error: " + error.message);
        });
    }

    // âœ… Google Login
    function signInWithGoogle() {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider)
        .then((result) => {
          alert("Logged in as: " + result.user.displayName);
          window.location.href = "index.html";
        })
        .catch((error) => {
          alert("Error: " + error.message);
        });
    }

    // âœ… Phone Number Login (Invisible reCAPTCHA)
    let confirmationResult;

    window.onload = () => {
      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        size: 'invisible',
        callback: () => {
          console.log("Invisible reCAPTCHA verified âœ…");
        }
      });
    };

    // Send OTP
    function sendOTP() {
      let phoneNumber = document.getElementById("phoneNumber").value.trim();

      if (!phoneNumber.startsWith("+")) {
        alert("âŒ Phone number must be in international format, e.g. +919876543210");
        return;
      }

      auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
        .then((result) => {
          confirmationResult = result;
          alert("OTP sent!");
          document.getElementById("otpSection").style.display = "block";
        })
        .catch((error) => {
          alert("Error: " + error.message);
        });
    }

    // Verify OTP
    function verifyOTP() {
      const code = document.getElementById("otpCode").value;
      confirmationResult.confirm(code)
        .then((result) => {
          alert("Phone verified! Logged in as: " + result.user.phoneNumber);
          window.location.href = "index.html";
        })
        .catch((error) => {
          alert("Invalid OTP: " + error.message);
        });
    }
  </script>
</body>
</html>
